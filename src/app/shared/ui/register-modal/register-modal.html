<pre>{{form.errors | json}}</pre>

<div class="fixed inset-0 z-40 bg-black/80 backdrop-blur-sm" aria-hidden="true" (click)="onCancel()"></div>
<div class="fixed inset-0 z-50 flex items-center justify-center p-4">
  <div role="dialog" aria-modal="true" aria-labelledby="register-title"
    class="w-full max-w-md glass-panel p-6 sm:p-8 outline-none max-h-[90vh] overflow-auto animate-fade-in">
    <h2 id="register-title" class="text-2xl sm:text-3xl font-bold font-christmas text-gold-gradient drop-shadow-lg mb-2">
      Rejoindre la famille
    </h2>
    <p class="text-white/70">Crée ton compte pour gérer tes listes de cadeaux.</p>

    <div class="mt-6">
      <app-christmas-button variant="secondary" size="sm" (click)="loginGoogle()" [disabled]="loading()" [customClass]="'w-full justify-center !text-xs !py-3'">
        <div class="flex items-center gap-2">
          <svg viewBox="0 0 24 24" class="size-4 shrink-0" aria-hidden="true"><path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .533 5.333.533 12S5.867 24 12.48 24c3.44 0 6.04-1.133 8.16-3.293 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.12H12.48z" fill="currentColor"/></svg>
          <span>Continuer avec Google</span>
        </div>
      </app-christmas-button>
    </div>

    <div class="flex items-center gap-2 py-3">
      <div class="h-px bg-white/10 flex-1"></div>
      <span class="text-[10px] text-white/30 uppercase tracking-widest">OU</span>
      <div class="h-px bg-white/10 flex-1"></div>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-4">
      <div class="space-y-4">
        <div>
          <label class="sr-only" for="displayName">Nom ou pseudo</label>
          <input
            id="displayName"
            type="text"
            formControlName="displayName"
            uiInput
            placeholder="Ton petit nom (ex: Julie)"
            autocomplete="name"
            [invalid]="form.controls.displayName.invalid && form.controls.displayName.touched"
            class="text-lg placeholder-white/40"
            autofocus
          >
        </div>

        <div>
          <label class="sr-only" for="regEmail">Email</label>
          <input
            id="regEmail"
            type="email"
            formControlName="email"
            uiInput
            placeholder="Adresse email"
            autocomplete="username"
            [invalid]="form.controls.email.invalid && form.controls.email.touched"
            class="text-lg placeholder-white/40"
          >
        </div>

        <div>
          <label class="sr-only" for="regPassword">Mot de passe</label>
          <input
            id="regPassword"
            type="password"
            formControlName="password"
            uiInput
            placeholder="Mot de passe (6+ caractères)"
            autocomplete="new-password"
            [invalid]="form.controls.password.invalid && form.controls.password.touched"
            class="text-lg placeholder-white/40"
          >
        </div>

        <div>
          <label class="sr-only" for="regConfirmPassword">Confirmer le mot de passe</label>
          <input
            id="regConfirmPassword"
            type="password"
            formControlName="confirmPassword"
            uiInput
            placeholder="Confirmer le mot de passe"
            autocomplete="new-password"
            [invalid]="(form.controls.confirmPassword.invalid || form.errors?.['passwordMismatch']) && form.controls.confirmPassword.touched"
            class="text-lg placeholder-white/40"
          >
          @if (form.errors?.['passwordMismatch'] && form.controls.confirmPassword.touched) {
             <p class="text-red-300 text-xs mt-1 ml-1">Les mots de passe ne correspondent pas.</p>
          }
        </div>
      </div>

      @if (error()) {
        <p class="text-sm text-red-400 bg-red-900/20 px-3 py-2 rounded border border-red-500/20" role="alert">
          {{ error() }}
        </p>
      }

      <div class="mt-8 flex flex-col-reverse sm:flex-row sm:items-center sm:justify-end gap-2 sm:gap-3">
        <app-christmas-button variant="secondary" size="sm" (click)="onCancel()" [disabled]="loading()" [customClass]="'w-full sm:w-auto'">
          Annuler
        </app-christmas-button>
        <app-christmas-button variant="primary" size="sm" type="submit" [busy]="loading()"
          [disabled]="loading() || form.invalid" [customClass]="'w-full sm:w-auto'">
          {{ loading() ? 'Création…' : 'Créer mon compte' }}
        </app-christmas-button>
      </div>
    </form>
  </div>
</div>
